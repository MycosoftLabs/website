# Mycosoft Security Operations Center - Docker Compose
# Add this to your main docker-compose.yml or run separately
#
# Usage:
#   docker-compose -f docker-compose.security.yml up -d
#
# This file adds security monitoring services to the Mycosoft stack

version: '3.8'

services:
  # ==========================================================================
  # SECURITY OPERATIONS CENTER
  # ==========================================================================
  
  security-monitor:
    build:
      context: ./services/security
      dockerfile: Dockerfile
    container_name: mycosoft-security-monitor
    environment:
      - UNIFI_HOST=192.168.0.1
      - UNIFI_API_KEY=${UNIFI_API_KEY}
      - SLACK_SECURITY_WEBHOOK=${SLACK_SECURITY_WEBHOOK}
      - MYCOSOFT_CONFIG_PATH=/opt/mycosoft
      - PYTHONUNBUFFERED=1
    volumes:
      - security_logs:/var/log/mycosoft/security
      - ./config/security:/opt/mycosoft/config/security:ro
      - /opt/mycosoft/data/geoip:/data/geoip:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import socket; s=socket.socket(); s.settimeout(2); s.connect(('localhost', 8099)); s.close()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - mycosoft-network
    labels:
      - "com.mycosoft.service=security-monitor"
      - "com.mycosoft.category=security"
      - "com.mycosoft.priority=critical"

  # ==========================================================================
  # THREAT INTELLIGENCE (Optional - MaxMind GeoIP)
  # ==========================================================================
  
  geoip-updater:
    image: maxmindinc/geoipupdate:latest
    container_name: mycosoft-geoip-updater
    environment:
      - GEOIPUPDATE_ACCOUNT_ID=${MAXMIND_ACCOUNT_ID}
      - GEOIPUPDATE_LICENSE_KEY=${MAXMIND_LICENSE_KEY}
      - GEOIPUPDATE_EDITION_IDS=GeoLite2-City GeoLite2-Country GeoLite2-ASN
      - GEOIPUPDATE_FREQUENCY=168  # Update weekly
    volumes:
      - geoip_data:/usr/share/GeoIP
    restart: unless-stopped
    networks:
      - mycosoft-network

networks:
  mycosoft-network:
    external: true

volumes:
  security_logs:
    driver: local
  geoip_data:
    driver: local
